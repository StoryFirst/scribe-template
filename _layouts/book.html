---
layout: default
---
<article class="book-detail px-4 py-8">
  <header class="mb-8">
    <h1 class="text-4xl font-bold mb-4">{{ page.name }}</h1>
    {% if page.description %}
      <div class="text-lg text-gray-700 mb-6 prose max-w-none">
        <div class="content">{{ page.description | markdownify }}</div>
      </div>
    {% endif %}
  </header>

  {% if page.content and page.content != "" %}
    <div class="book-content prose max-w-none mb-12">
      {{ content }}
    </div>
  {% endif %}

  {% if page.cast and page.cast.size > 0 %}
  <section class="cast mb-12">
    <h2 class="text-2xl font-bold mb-6">Cast</h2>

    {% assign cast_by_role = page.cast | group_by: "role" %}
    {% assign role_order = "main_ensamble,protagonist,supporting_character,antagonist" | split: "," %}

    {% for role_name in role_order %}
      {% assign role_group = cast_by_role | where: "name", role_name | first %}
      {% if role_group %}
        <div class="mb-8">
          <h3 class="text-lg font-semibold mb-4 text-gray-800">{{ role_name | replace: "_", " " | capitalize }}</h3>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6">
            {% for cast_member in role_group.items %}
              {% assign character = site.characters | where: "scribe_id", cast_member.id | first %}
              {% if character %}
                <div class="character-card">
                  <a href="{{ character.url }}" class="block group">
                    {% if character.image_url %}
                      <img src="{{ character.image_url }}" alt="{{ character.name }}" class="w-full aspect-square object-cover rounded-lg shadow-sm group-hover:shadow-md transition-shadow">
                    {% endif %}
                    <div class="mt-2">
                      <h4 class="text-base font-bold text-gray-900 group-hover:text-brand-primary transition-colors">
                        {{ character.name }}
                      </h4>
                      {% if cast_member.role %}
                        {% assign badge_color = "bg-gray-500" %}
                        {% if cast_member.role == "main_ensamble" or cast_member.role == "protagonist" %}
                          {% assign badge_color = "bg-green-600" %}
                        {% elsif cast_member.role == "supporting_character" %}
                          {% assign badge_color = "bg-blue-600" %}
                        {% elsif cast_member.role == "antagonist" %}
                          {% assign badge_color = "bg-red-600" %}
                        {% endif %}
                        <span class="inline-block px-2 py-0.5 mt-1 text-xs font-medium text-white {{ badge_color }} rounded-full">
                          {{ cast_member.role | replace: "_", " " | capitalize }}
                        </span>
                      {% endif %}
                      {% if character.caption %}
                        <p class="text-xs text-gray-600 italic mt-1">{{ character.caption }}</p>
                      {% endif %}
                    </div>
                  </a>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endif %}
    {% endfor %}

    {% comment %} Handle any roles not in the predefined order {% endcomment %}
    {% for role_group in cast_by_role %}
      {% unless role_order contains role_group.name %}
        <div class="mb-8">
          <h3 class="text-lg font-semibold mb-4 text-gray-800">{{ role_group.name | replace: "_", " " | capitalize }}</h3>
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6">
            {% for cast_member in role_group.items %}
              {% assign character = site.characters | where: "scribe_id", cast_member.id | first %}
              {% if character %}
                <div class="character-card">
                  <a href="{{ character.url }}" class="block group">
                    {% if character.image_url %}
                      <img src="{{ character.image_url }}" alt="{{ character.name }}" class="w-full aspect-square object-cover rounded-lg shadow-sm group-hover:shadow-md transition-shadow">
                    {% endif %}
                    <div class="mt-2">
                      <h4 class="text-base font-bold text-gray-900 group-hover:text-brand-primary transition-colors">
                        {{ character.name }}
                      </h4>
                      {% if cast_member.role %}
                        <span class="inline-block px-2 py-0.5 mt-1 text-xs font-medium text-white bg-gray-500 rounded-full">
                          {{ cast_member.role | replace: "_", " " | capitalize }}
                        </span>
                      {% endif %}
                      {% if character.caption %}
                        <p class="text-xs text-gray-600 italic mt-1">{{ character.caption }}</p>
                      {% endif %}
                    </div>
                  </a>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endunless %}
    {% endfor %}
  </section>
  {% endif %}

  <section class="chapters">
    <h2 class="text-2xl font-bold mb-6">Chapters</h2>

    {% assign book_chapters = site.chapters | where: "book_id", page.scribe_id | sort: "number" %}

    {% if book_chapters.size > 0 %}
      <ol class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 list-none">
        {% for chapter in book_chapters %}
          <li class="chapter-card border border-gray-300 rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow">
            <a href="{{ chapter.url }}" class="block">
              {% if chapter.image_url %}
                <img src="{{ chapter.image_url }}" alt="{{ chapter.name }}" class="w-full aspect-square object-cover">
              {% endif %}
              <div class="p-4">
                <div class="text-sm text-gray-500 mb-1">Chapter {{ chapter.number }}</div>
                <h3 class="text-lg font-bold text-gray-900 hover:text-brand-primary transition-colors">
                  {{ chapter.name }}
                </h3>
                {% if chapter.caption %}
                  <p class="text-sm text-gray-600 italic mt-2">{{ chapter.caption }}</p>
                {% endif %}
              </div>
            </a>
          </li>
        {% endfor %}
      </ol>
    {% else %}
      <p class="text-gray-500 italic">No chapters found for this book.</p>
    {% endif %}
  </section>
</article>
